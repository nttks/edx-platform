<%inherit file="../main_biz.html" />
<%!
from django.utils.translation import ugettext as _
from django.core.urlresolvers import reverse
%>

<%block name="pagetitle">${_("Survey Download")}</%block>

<%block name="js_extra">
<script type="text/javascript">
    $(function () {
        $('#form').w2form({name: 'form'});
        $('.w2ui-buttons').on('click', '#download-btn', function () {
            if ($('#encoding-utf8').prop('checked')) {
                saveInstructorSurveyEncodingUTF8('true');
                downloadFileUsingPost($(this).data('endpointUtf8'));
            } else {
                saveInstructorSurveyEncodingUTF8('false');
                downloadFileUsingPost($(this).data('endpoint'));
            }
        });
        $('#encoding-utf8').prop('checked', getInstructorSurveyEncodingUTF8());
    });
    
    function saveInstructorSurveyEncodingUTF8(value) {
        if (window.localStorage) {
            window.localStorage.setItem('biz.survey.encodingUTF8', value);
        }
    }
    
    function getInstructorSurveyEncodingUTF8() {
        if (window.localStorage) {
            return window.localStorage.getItem('biz.survey.encodingUTF8') === 'true';
        }
    }
</script>
</%block>

<%block name="custom_content">
<div id="form" class="field-area">
    <div class="w2ui-page page-0">
        <div class="field">
            <span class="operation">${_("You can download the survey results.")}</span>
        </div>
    </div>
    <div class="w2ui-buttons">
        <input type="button" id="download-btn" data-endpoint="${reverse('biz:course_operation:survey_download')}" data-endpoint-utf8="${reverse('biz:course_operation:survey_download_utf8')}" value="&#xf1c3 ${_("Get Survey CSV")}"/><br/>
        <input type="checkbox" id="encoding-utf8" /><label for="encoding-utf8" class="encoding-utf8">${_("If you want to download the file in UTF-8, please place a check mark and then push the button.")}</label>
    </div>
</div>
</%block>
